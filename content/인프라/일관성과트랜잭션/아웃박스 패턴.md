> DB 업데이트와 이벤트 발행을 성공시키는 방법이다.

- DB를 업데이트하고 이벤트를 발행할 때([[Kafka란?]] 등), 하나만 성공할 수 있다.
	- DB 업데이트는 성공했으나, 이벤트 발행은 실패
	- 이벤트 발행은 성공했으나, DB 업데이트는 실패
- 이 문제를 해결하기 위해 **이벤트 발행 대신에 DB 트랜잭션 수준에서 작업을 묶어버리는 것**이다.
## 방식
1. 트랜잭션 시작
2. DB 업데이트
3. DB의 Outbox에 발행할 이벤트 저장
4. 트랜잭션 종료
5. 별도의 프로세스가 Outbox를 풀링하여 이벤트 발행
## 발생 가능한 문제 : 중복 전송
- 결국 별도의 프로세스가
	1. DB의 메시지를 읽고
	2. 메시지를 보내고
	3. DB의 메시지를 보냈다고 표시해야 한다.
- **결국 하나의 트랜잭션으로 묶이지 않는다.**
- 다만, 아웃박스 패턴은 묶이지 않더라도 최악의 경우 메시지를 여러번 전송하는 것에 멈춘다.
- 즉 **0~1번 -> 1~N번**의 향상인 것이다.
- 이 문제는 메시지를 받는 측에서의 멱등성 처리를 통해서 할 수 있다.
	- 예를 들어, 한번 받은 메시지는 다시 처리하지 않도록 한다.