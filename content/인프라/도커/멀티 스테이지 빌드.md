> 최종 결과물에 필요없는 것과, 필요있는 것을 스테이지로 나누어 이미지 크기를 줄이는 방법

- 예를 들어, gradle 빌드 -> java 실행의 플로우를 가진 이미지를 만든다고 쳐보자.
- 기본적으로 빌드하면 다음 결과물들이 포함된다.
	- gradle
	- java
	- 소스 코드
	- 캐시
	- jar 파일
- 여기서 진짜 필요한 것은 java와 jar파일 뿐이다.
  따라서 gradle+소스코드+캐시 를 첫번째 스테이지, java+jar파일을 두번째 스테이지로 가져가는 것이다.
- **이미지 크기가 줄어들 뿐 아니라, 소스 코드 등이 포함되지 않으므로 보안적으로도 유리하다.**
## 안좋은 예시
```dockerfile
FROM amazoncorretto:21

WORKDIR /app

COPY . .

RUN ./gradlew bootJar --no-daemon

RUN mv build/libs/*.jar coursepick-backend.jar

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "coursepick-backend.jar"]
```
## 멀티 스테이지 빌드를 활용하는 예시
```dockerfile
# --- 스테이지 1: 빌드 (이름을 'builder'라고 지정) ---
FROM amazoncorretto:21 AS builder
WORKDIR /build

# 전체 소스 복사 및 빌드
COPY . .
RUN ./gradlew bootJar --no-daemon


# --- 스테이지 2: 실행 (최종 이미지) ---
FROM amazoncorretto:21
WORKDIR /app

# 'builder' 스테이지에서 생성된 JAR 파일만 현재 스테이지(/app)로 복사
# 이 과정에서 스테이지 1의 소스 코드와 캐시는 모두 버려짐
COPY --from=builder /build/build/libs/*.jar coursepick-backend.jar

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "coursepick-backend.jar"]
```