> 바뀌지 않는 부분과 잘 바뀌는 부분을 분리하여 빌드 속도를 빠르게 한다.

- [[Dockerfile]]에서는 매 명령어가 레이어로 분리된다.
- 따라서 바뀌지 않은 레이어까지는 그대로 쓰고, 바뀐 부분부터는 새로 빌드한다.
- 라이브러리같이 잘 바뀌지 않는 부분을 위로 두고, 소스 코드와 관련된 잘 바뀌는 부분을 아래에 두면 빌드 속도를 획기적으로 빠르게 할 수 있다.
## 안좋은 예시
```dockerfile
FROM gradle:8.5-jdk21 AS builder
WORKDIR /build

# 모든 파일을 한꺼번에 복사 (build.gradle + 소스 코드)
COPY . . 

# 여기서 코드가 1바이트만 바뀌어도 아래의 RUN 명령어는 캐시를 못 쓰고 
# 모든 라이브러리를 다시 인터넷에서 다운로드 (매우 느림)
RUN gradle bootJar --no-daemon
```
- `copy . .` 부분이 매번 바뀌므로 `bootJar`에서 라이브러리를 매번 새로 다운로드 해야 한다.
## 좋은 예시
```dockerfile
FROM gradle:8.5-jdk21 AS builder
WORKDIR /build

# 1. 의존성 관련 파일만 먼저 복사
COPY build.gradle settings.gradle ./
COPY gradle ./gradle
COPY gradlew ./

# 2. 라이브러리만 미리 다운로드 (핵심!)
# --no-daemon 옵션과 함께 의존성만 가져오는 명령 수행
RUN ./gradlew dependencies --no-daemon

# 3. 이제서야 실제 소스 코드를 복사
COPY src ./src

# 4. 빌드 실행
# 이미 위에서 라이브러리를 다 받았으므로, 소스 코드 빌드만 빠르게 진행됩니다.
RUN ./gradlew bootJar --no-daemon
```
- 라이브러리 설치까지는 캐싱되며, `copy src ./src` 부분부터는 매번 새로 실행한다.