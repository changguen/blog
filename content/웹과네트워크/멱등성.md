## 멱등성이란

- 동일한 요청을 여러번 수행해도 **서버 상태가 동일한 것**
- HTTP 메서드별 멱등성
    - GET은 멱등성을 가진다. 여러번 조회해도 되기 때문이다.
    - PUT은 멱등성을 가진다. 데이터 자체를 **전부** 교체하기 때문에 상태 자체는 변경된 상태로 동일하기 때문이다.
    - DELETE는 멱등성을 가진다. 데이터를 삭제하기 때문에 상태 자체는 삭제된 상태로 동일하기 때문이다.
    - **POST는 멱등성이 없다!** 새로운 데이터를 추가 하는 등의 기능은 상태를 지속적으로 변화시킬 수 있기 때문이다.
    - **PATCH는 멱등성이 없을 수 있다!** 점수+10 하는 등의 기능은 상태를 지속적으로 변화시킬 수 있기 때문이다.
        - 위와 같은 것을 명령형이라고 부르며, 멱등하지 않다.
        - 반면에 PUT과 비슷한 느낌의 정적 변경은 멱등하다.
- 중요한 것은 서버의 상태이지, 응답이 아니다.
    - 예시
        - DELETE `/posts/1` 첫번째 : 200 OK, 데이터 삭제
        - DELETE `/posts/1` 두번째 : 404 NOT FOUND
    - 위와 같은 예시에도 두 요청 모두 데이터가 삭제된 상태라는 서버 상태는 동일하므로 멱등하다.

## 멱등성은 왜 중요한가?

- 멱등성의 가치는 안전한 재시도에서 온다.
- 예시 (멱등하지 않을 때)
    - 클라이언트가 토스 결제 승인 API를 호출했다.
    - 네트워크 문제로 응답을 받지 못했다.
    - 클라이언트는 혼란에 빠진다…
        - 결제가 됐는데 응답이 안온건가? 아니면 결제 자체가 실패한건가??
        - 결제는 해야겠는데, 다시 시도하면 중복 결제가 될 수도 있다.
- 예시 (멱등할 때)
    - 예를 들어, 토스가 2번 결제하면 2번째는 무시한다고 가정하자.
    - 클라이언트가 토스 결제 승인 API를 호출했다.
    - 네트워크 문제로 응답을 받지 못했다.
    - 클라이언트는 웃는다.
        - 다시 시도하면 된다.
        - 어차피 중복 결제 등의 문제는 발생하지 않기 때문이다! (멱등하기 때문이다!)

### 참고 - 멱등성 VS 안전함

- 안전함 : 상태를 변화시키지 않는다.
    - A → A → A → A
- 멱등성 : 상태가 처음 호출과 동일하게 남는다.
    - A → B → B → B (상태가 계속 B로 남아있다.)
    - A → A → A → A (상태가 계속 A로 남아있다.)
- 멱등성이 안전함의 슈퍼셋이다.