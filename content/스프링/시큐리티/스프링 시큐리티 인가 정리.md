## 인가 흐름 (6.5.0 기준)

- `SecurityContextHolder` 에 인가 정보가 존재한다.
    - 세션 기반 ****: `SecurityContextPersistenceFilter` 가 요청 초기에 세션에서 `SecurityContext` 를 읽어 ThreadLocal에 저장하고, 응답 직전에 다시 세션으로 복구한다.
    - 토큰 기반 : 커스텀 `JwtAuthenticationFilter` 등이 매 요청마다 토큰을 검증해 `SecurityContextHolder` 에 넣고, 필터 체인이 끝나면 `SecurityContextHolder.clearContext()` 로 제거한다.
- URL 기반 인가
    - `AuthorizationFilter` 가 요청을 가로채 인가처리를 수행한다.
    - `AuthorizationManager<HttpServletRequest>` 에 `Authentication` 과 요청을 넘겨서 인가 처리를 위임한다.
    - `AuthorizationManager` 는 인가 가능 여부를 판단하여 반환한다.

![[스프링 시큐리티 인가 정리_image.png]]

- 메서드 기반 인가
    - `MethodSecurityInterceptor` AOP에서 컨트롤러 메서드 호출 전에 인가처리를 수행한다.
    - `AuthorizationManager<MethodInvocation>` 에 `Authentication` 과 메서드 정보를 넘겨서 인가 처리를 위임한다.
    - `AuthorizationManager` 는 인가 가능 여부를 판단하여 반환한다.

![[스프링 시큐리티 인가 정리_image 1.png]]